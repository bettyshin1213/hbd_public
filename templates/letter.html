{% extends "base.html" %}
{% block title %}Letter from developer{% endblock %}

{% block content %}
<section class="section">
  <h2 style = "margin-bottom: 20px;">ğŸ’Œ Letter from developer</h2>

  <div class="card" style="max-width:720px; margin:0 auto;">
    <h3 style="margin-top:0; text-align: center">??ì—ê²Œ, bettyshin1213ì´</h3>
    <!-- Letter ì „ìš© ì‚¬ì§„ ìŠ¬ë¼ì´ë” -->
  {% if photos and photos|length > 0 %}
    <div class="card photo-card" style="padding:0; overflow:hidden; border-radius:12px;">
      <div class="swiper letter-swiper" style="width:100%; position:relative;">
        <div class="swiper-wrapper">
          {% for p in photos %}
          <div class="swiper-slide" style="display:flex; align-items:center; justify-content:center;">
            <div class="photo-frame"
                 style="width:100%; height:55vh; max-height:420px; min-height:220px; margin:0 auto; position:relative; overflow:hidden; border-radius:12px; background:rgba(0,0,0,.06);">
              <img class="photo-img"
                   src="{{ p.url }}" alt="{{ p.name }}"
                   style="position:absolute; inset:0; width:100%; height:100%; object-fit:contain; object-position:center; display:block;">
            </div>
          </div>
          {% endfor %}
        </div>
        <div class="swiper-button-prev" style="top:50%; transform:translateY(-50%); color:#fff; text-shadow:0 2px 10px rgba(0,0,0,.35);"></div>
        <div class="swiper-button-next" style="top:50%; transform:translateY(-50%); color:#fff; text-shadow:0 2px 10px rgba(0,0,0,.35);"></div>
        <div class="swiper-pagination" style="bottom:8px;"></div>
      </div>
    </div>
  {% else %}
    <p class="muted">ì•„ì§ í¸ì§€ ì‚¬ì§„ì´ ì—†ì–´ìš”.</p>
  {% endif %}

    <div style="white-space:pre-wrap; line-height:1.6; text-align: center">
ìƒì¼ ì¶•í•˜í•´ ğŸ¥³
    </div>
  </div>
</section>
{% block body_extra %}
<!-- í•˜íŠ¸: confetti ì‹œë„ + CSS í´ë°± -->
<script>
(function(){
  let fired = false;

  function runConfettiHearts(){
    if (typeof confetti !== 'function') return false;
    fired = true;

    // ê°„ë‹¨ í•˜íŠ¸ path â†’ ë²¡í„° íŒŒí‹°í´
    let heartShape;
    try {
      const HEART_PATH = "M24 42c-7-4-12-9-12-16 0-5 4-9 9-9 3 0 5 1 7 3 2-2 4-3 7-3 5 0 9 4 9 9 0 7-5 12-12 16z";
      heartShape = confetti.shapeFromPath({ path: HEART_PATH });
    } catch(e){
      heartShape = 'circle';
    }

    // ìœ„ì—ì„œ í•˜ëŠ˜í•˜ëŠ˜ ë‚´ë ¤ì˜¤ëŠ” ëŠë‚Œ
    const duration = 24000;
    const end = Date.now() + duration;
    (function frame(){
      confetti({
        particleCount: 1,
        angle: 90,                // ìœ„â†’ì•„ë˜
        spread: 100,
        startVelocity: 20,
        ticks: 700,
        gravity: 0.4,
        drift: (Math.random()-0.5)*0.8,
        scalar: 1.6,
        origin: { x: Math.random(), y: -0.01 }, // ì‚´ì§ í™”ë©´ ìœ„ì—ì„œ ë°œìƒ
        shapes: [heartShape],
        colors: ['#ff4d4d','#ff8080','#ff1a1a']
      });
      if (Date.now() < end) {
        setTimeout(frame, 180); // 0.12ì´ˆë§ˆë‹¤ ë°œì‚¬ â†’ ë°€ë„ í™• ì¤„ì–´ë“¦
      }
    })();
    return true;
  }

  function runCssFallback(){
    if (fired) return;
    // ì»¨í…Œì´ë„ˆ
    const wrap = document.createElement('div');
    wrap.id = 'heart-rain';
    document.body.appendChild(wrap);

    // í•˜íŠ¸ ì—¬ëŸ¬ ê°œ ìƒì„±
    const HEARTS = 28;  // ê°œìˆ˜ (ì›í•˜ë©´ ì¡°ì ˆ)
    for (let i=0;i<HEARTS;i++){
      const h = document.createElement('div');
      h.className = 'heart';
      h.textContent = 'â¤ï¸';
      // ëœë¤ ìœ„ì¹˜/í¬ê¸°/ì§€ì—°/ì†ë„/í”ë“¤ë¦¼
      h.style.left = Math.random()*100 + 'vw';
      h.style.fontSize = (Math.random()*12 + 14) + 'px';
      h.style.animationDelay = (Math.random()*0.8) + 's';
      h.style.animationDuration = (Math.random()*2 + 2.8) + 's';
      h.style.setProperty('--drift', (Math.random()*40 - 20) + 'px');
      wrap.appendChild(h);
    }
  }

  // 1) confetti ìˆìœ¼ë©´ ë°”ë¡œ ì‹¤í–‰
  if (typeof confetti === 'function') {
    runConfettiHearts();
  } else {
    // 2) ì—†ìœ¼ë©´ ë¡œë“œ ì‹œë„
    const s = document.createElement('script');
    s.src = 'https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js';
    s.onload = () => {
      // ë¡œë“œëìœ¼ë©´ confetti ì‹¤í–‰
      if (!runConfettiHearts()) runCssFallback();
    };
    s.onerror = runCssFallback;
    document.head.appendChild(s);
    // 1ì´ˆ ì•ˆì— onloadê°€ ì•ˆ ì˜¤ë©´ í´ë°±
    setTimeout(runCssFallback, 1000);
  }
})();
</script>

<script>
  window.addEventListener('DOMContentLoaded', function () {
    if (typeof Swiper !== 'undefined') {
      new Swiper('.letter-swiper', {
        slidesPerView: 1,
        spaceBetween: 10,
        loop: true,
        preloadImages: true,
        autoHeight: false,
        pagination: { el: '.letter-swiper .swiper-pagination', clickable: true },
        navigation: { nextEl: '.letter-swiper .swiper-button-next', prevEl: '.letter-swiper .swiper-button-prev' },
        keyboard: { enabled: true }
      });
    }
  });
</script>

<style>
/* CSS í´ë°±ìš© í•˜íŠ¸ë¹„ */
#heart-rain{
  pointer-events: none;
  position: fixed;
  inset: 0;
  overflow: hidden;
  z-index: 9999;
}
#heart-rain .heart{
  position: absolute;
  top: -5vh;
  will-change: transform, opacity;
  animation-name: heartFall, heartSway;
  animation-timing-function: linear, ease-in-out;
  animation-iteration-count: 1, infinite;
}
@keyframes heartFall{
  0%   { transform: translateY(-10vh); opacity: 0; }
  10%  { opacity: 1; }
  100% { transform: translateY(110vh); opacity: 0; }
}
@keyframes heartSway{
  0%   { transform: translateX(0); }
  50%  { transform: translateX(var(--drift, 16px)); }
  100% { transform: translateX(0); }
}
</style>
{% endblock %}

{% block footer_extra %}
<div style="text-align:center; margin-top: 4px;">
  <form action="{{ url_for('logout') }}" method="post" style="display:inline;">
    {{ csrf_token() if csrf_token is defined }}
    <button class="btn btn-ghost" style="padding:6px 12px;">ë¡œê·¸ì•„ì›ƒ</button>
  </form>
</div>
{% endblock %}
{% endblock %}